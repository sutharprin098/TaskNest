<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TaskNest - Home Cooking</title>
<link href="https://fonts.googleapis.com/css2?family=Fraunces:wght@600;700&family=Manrope:wght@400;500;600;700&display=swap" rel="stylesheet">
<style>
/* --- GLOBAL STYLES --- */
:root {
  --primary: #1E7E7A;
  --primary-dark: #125C5A;
  --sky: #E6F6FF;
  --bg: #F3F7F8;
  --white: #FFFFFF;
  --text: #0F172A;
  --muted: #5B6B7A;
  --border: #E2E8F0;
  --accent: #7AD7D0;
}

body {
  margin: 0;
  font-family: 'Manrope', sans-serif;
  background: radial-gradient(1200px 500px at 10% -10%, #E6F6FF 0%, #F3F7F8 45%, #F7FBFC 100%);
  color: var(--text);
  -webkit-tap-highlight-color: transparent;
  padding-bottom: 40px;
}

header {
  background: rgba(255,255,255,0.9);
  backdrop-filter: blur(6px);
  padding: 16px 20px;
  text-align: center;
  font-size: 20px;
  font-weight: 700;
  color: var(--primary-dark);
  box-shadow: 0 10px 20px rgba(15, 23, 42, 0.06);
  position: sticky;
  top: 0;
  z-index: 100;
}

.container {
  max-width: 980px;
  margin: 22px auto;
  padding: 0 16px;
}

/* CARDS */
.card {
  background: var(--white);
  border-radius: 22px;
  padding: 24px;
  margin-bottom: 20px;
  box-shadow: 0 16px 32px rgba(15, 23, 42, 0.08);
  border: 1px solid rgba(226, 232, 240, 0.8);
  animation: fadeUp 0.4s ease-in-out;
}

.form-card { max-width: 560px; margin: 0 auto 24px auto; }

@keyframes fadeUp {
  from { opacity: 0; transform: translateY(12px); }
  to { opacity: 1; transform: translateY(0); }
}

h2 {
  margin: 0 0 10px 0;
  font-family: 'Fraunces', serif;
  font-size: 26px;
  color: var(--primary-dark);
}
p { margin: 0 0 15px 0; color: var(--muted); font-size: 14px; line-height: 1.6; }

/* HERO */
.hero {
  display: grid;
  grid-template-columns: 1.1fr 0.9fr;
  gap: 18px;
  align-items: center;
  background: linear-gradient(140deg, rgba(122, 215, 208, 0.18), rgba(230, 246, 255, 0.7));
  border-radius: 18px;
  padding: 18px;
  border: 1px solid rgba(122, 215, 208, 0.3);
}

.eyebrow {
  font-size: 12px;
  letter-spacing: 1.5px;
  text-transform: uppercase;
  color: var(--primary);
  font-weight: 700;
}

.hero-meta { display: flex; gap: 8px; flex-wrap: wrap; margin: 12px 0 16px; }

.pill {
  display: inline-flex;
  align-items: center;
  gap: 6px;
  padding: 6px 10px;
  border-radius: 999px;
  font-size: 12px;
  font-weight: 600;
  background: var(--primary-dark);
  color: white;
}

.pill.light { background: white; color: var(--primary-dark); border: 1px solid var(--border); }

.hero-img {
  width: 100%;
  height: 220px;
  object-fit: cover;
  border-radius: 16px;
  box-shadow: 0 10px 20px rgba(15, 23, 42, 0.12);
}

.hero-actions { display: flex; gap: 10px; flex-wrap: wrap; }
.hero-actions .btn,
.hero-actions button { width: auto; margin-top: 0; }

/* INPUTS & BUTTONS */
input, select, textarea {
  width: 100%;
  padding: 14px;
  border: 1px solid var(--border);
  border-radius: 14px;
  background: #F9FBFC;
  font-family: inherit;
  font-size: 14px;
  box-sizing: border-box;
  margin-top: 8px;
}
input:focus, select:focus, textarea:focus { outline: none; border-color: var(--primary); background: #fff; }

label { font-size: 13px; font-weight: 600; color: #415161; display: block; margin-top: 15px; }

button, .btn {
  width: 100%;
  padding: 14px 16px;
  margin-top: 18px;
  background: var(--primary);
  color: white;
  border: none;
  border-radius: 14px;
  font-size: 15px;
  font-weight: 700;
  cursor: pointer;
  transition: transform 0.15s ease, box-shadow 0.2s ease;
}
button:hover, .btn:hover { transform: translateY(-1px); box-shadow: 0 8px 18px rgba(30, 126, 122, 0.2); }
button:active, .btn:active { transform: scale(0.98); }

.btn.ghost {
  background: white;
  color: var(--primary-dark);
  border: 1px solid var(--border);
}

.secondary-btn {
  background: white;
  color: var(--primary-dark);
  border: 1px solid var(--border);
  margin-top: 10px;
}

/* UTILS */
.hidden { display: none !important; }
.badge { background: #E9FBF9; color: #0E5D5B; font-size: 11px; padding: 4px 8px; border-radius: 999px; font-weight: 700; float: right; }
.service-img { width: 100%; height: 180px; object-fit: cover; border-radius: 12px; margin-bottom: 16px; background-color: #eee; }

@keyframes softFloat {
  0% { transform: translateY(0); }
  50% { transform: translateY(-4px); }
  100% { transform: translateY(0); }
}

.service-img { animation: softFloat 6s ease-in-out infinite; }

/* SERVICES GRID */
.services-section { margin-top: 18px; }
.section-title { font-size: 16px; color: #324554; font-weight: 700; margin: 0 0 10px 0; }

.service-grid {
  display: grid;
  grid-template-columns: repeat(2, minmax(0, 1fr));
  gap: 14px;
}

.service-card {
  background: #fff;
  border: 1px solid var(--border);
  border-radius: 16px;
  overflow: hidden;
  box-shadow: 0 10px 20px rgba(15, 23, 42, 0.06);
  transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.service-card:hover { transform: translateY(-3px); box-shadow: 0 16px 26px rgba(15, 23, 42, 0.12); }

.service-thumb { width: 100%; height: 140px; object-fit: cover; }
.service-body { padding: 14px; }
.service-body h4 { margin: 0 0 6px 0; font-size: 15px; color: #16222E; }
.service-body p { margin: 0 0 12px 0; font-size: 12px; color: var(--muted); }
.service-actions { display: flex; flex-wrap: wrap; gap: 8px; align-items: center; }
.tag { font-size: 11px; font-weight: 700; color: var(--primary-dark); background: #E6F6FF; padding: 4px 8px; border-radius: 999px; }
.link-btn {
  font-size: 12px;
  font-weight: 700;
  text-decoration: none;
  color: var(--primary-dark);
  border: 1px solid var(--border);
  padding: 6px 10px;
  border-radius: 999px;
  background: white;
}
.link-btn.primary { background: var(--primary); color: white; border-color: var(--primary); }

/* GROCERY OPTIONS */
/* MAP & LOCATION */
iframe { width: 100%; height: 160px; border: 0; border-radius: 12px; background: #eee; margin-top: 8px;}
.loc-btn { background: #E6F6FF; color: var(--primary-dark); margin-top: 6px; padding: 10px; font-size: 14px; }

@media (max-width: 860px) {
  .hero { grid-template-columns: 1fr; }
  .service-grid { grid-template-columns: 1fr; }
  .hero-img { height: 200px; }
}

</style>
</head>
<body>

<header>TaskNest</header>

<div class="container">

  <div class="card" id="stepInfo">
    <div class="hero">
      <div class="hero-content">
        <div class="eyebrow">TaskNest Services</div>
        <h2 id="serviceTitle">Home-Style Cooking (1-6 people)</h2>
        <p id="serviceDesc">Premium occasional cooking service.</p>
        <div class="hero-meta">
          <span class="pill" id="servicePrice">‚Çπ499 / Visit</span>
          <span class="pill light">Hygienic cooks</span>
          <span class="pill light">Kitchen reset</span>
        </div>
        <div class="hero-actions">
          <button class="btn primary" onclick="openBooking()">Book This Service</button>
        </div>
      </div>
      <img class="hero-img" src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=1200&q=80" alt="Cooking service">
    </div>

    <div class="services-section">
      <h3 class="section-title">Choose a Service</h3>
      <div class="service-grid">
        <div class="service-card">
          <img class="service-thumb" src="https://images.unsplash.com/photo-1504674900247-0877df9cc836?auto=format&fit=crop&w=900&q=80" alt="Home-style cooking">
          <div class="service-body">
            <h4>Home-Style Cooking</h4>
            <p>Comfort meals for small families. Hygiene + kitchen reset.</p>
            <div class="service-actions">
              <span class="tag">1-6 people</span>
              <a class="link-btn" href="service-home.html">Details</a>
              <a class="link-btn primary" href="index.html?service=home-style-cooking&book=1">Book</a>
            </div>
          </div>
        </div>
        <div class="service-card">
          <img class="service-thumb" src="https://images.unsplash.com/photo-1517248135467-4c7edcad34c4?auto=format&fit=crop&w=900&q=80" alt="Event cooking">
          <div class="service-body">
            <h4>Event Cooking</h4>
            <p>Small gatherings, celebrations, and event support.</p>
            <div class="service-actions">
              <span class="tag">7-15 people</span>
              <a class="link-btn" href="service-event.html">Details</a>
              <a class="link-btn primary" href="index.html?service=event-cooking&book=1">Book</a>
            </div>
          </div>
        </div>
        <div class="service-card">
          <img class="service-thumb" src="https://images.unsplash.com/photo-1484154218962-a197022b5858?auto=format&fit=crop&w=900&q=80" alt="Home organization">
          <div class="service-body">
            <h4>Home Organization & Reset</h4>
            <p>Declutter, organize, and reset your space.</p>
            <div class="service-actions">
              <span class="tag">Full home</span>
              <a class="link-btn" href="service-organization.html">Details</a>
              <a class="link-btn primary" href="index.html?service=home-organization&book=1">Book</a>
            </div>
          </div>
        </div>
        <div class="service-card">
          <img class="service-thumb" src="https://images.unsplash.com/photo-1492684223066-81342ee5ff30?auto=format&fit=crop&w=900&q=80" alt="Concierge service">
          <div class="service-body">
            <h4>Seasonal / Event Concierge</h4>
            <p>Seasonal setup, planning, and concierge assistance.</p>
            <div class="service-actions">
              <span class="tag">Concierge</span>
              <a class="link-btn" href="service-concierge.html">Details</a>
              <a class="link-btn primary" href="index.html?service=seasonal-concierge&book=1">Book</a>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="card hidden form-card" id="stepBooking">
    
        <img src="https://images.unsplash.com/photo-1556910103-1c02745a30bf?auto=format&fit=crop&w=900&q=80"
          class="service-img" alt="Cooking Service">
    
    <h2 id="bookingTitle">Book Your Cook</h2>

    <label>Mobile Number</label>
    <input type="tel" id="loginPhone" placeholder="Enter 10-digit number" maxlength="10">

    <label>Ingredients Provided By</label>
    <select id="ingredientSource">
      <option value="Client brings ingredients">I will provide the ingredients</option>
      <option value="TaskNest provides ingredients">TaskNest will arrange everything</option>
    </select>
    <div style="margin-top:10px; padding:12px; background:#F8FAFC; border:1px solid #E2E8F0; border-radius:12px; font-size:12px; color:#5B6B7A; line-height:1.6;">
      <div style="font-weight:700; color:#125C5A; margin-bottom:6px;">Ingredients options</div>
      <div><b>I will provide the ingredients:</b> You purchase and keep ingredients ready. TaskNest handles cooking, hygiene, and kitchen reset only.</div>
      <div style="margin-top:6px;"><b>TaskNest will arrange everything:</b> We source fresh ingredients near your location. Ingredients billed at actual cost plus handling for convenience.</div>
    </div>
    
    <label>Location</label>
    <div style="background:#F9FAFB; padding:10px; border-radius:12px; border:1px solid #E5E7EB; margin-top:8px;">
      <iframe id="mapFrame" src="https://maps.google.com/maps?q=Delhi&t=&z=13&ie=UTF8&iwloc=&output=embed"></iframe>
      <button class="loc-btn" onclick="detectLocation()">üìç Detect My Location</button>
      <textarea id="address" placeholder="House No, Floor, Landmark..." rows="2" style="background:white;"></textarea>
      <div id="locStatus" style="font-size:11px; color:green; margin-top:5px;"></div>
    </div>

    <label>Full Name</label>
    <input type="text" id="name" placeholder="Your Name">

    <label>Date & Time</label>
    <div style="display:flex; gap:10px;">
      <input type="date" id="date">
      <select id="timeSlot"></select>
    </div>

    <button onclick="confirmAndWhatsApp()">Send on WhatsApp</button>
    <button onclick="backToDash()" class="secondary-btn">Cancel</button>
  </div>

  <div class="card hidden" id="stepSuccess" style="text-align:center; padding-top:40px;">
    <div style="width:70px; height:70px; background:#25D366; color:white; border-radius:50%; display:flex; align-items:center; justify-content:center; font-size:35px; margin:0 auto 20px auto;">‚úì</div>
    <h2>Booking Requested!</h2>
    <p>We received your request on WhatsApp.</p>
    
    <div style="background:#F0FDF4; padding:15px; border-radius:10px; margin:20px 0; text-align:left;">
      <p style="margin:5px 0; color:#166534; font-size:13px;"><b>Status:</b> Pending Confirmation</p>
      <p style="margin:5px 0; color:#166534; font-size:13px;">You will receive a confirmation shortly.</p>
    </div>

    <button onclick="location.reload()" class="secondary-btn">Home</button>
  </div>

</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
  import { getFirestore, collection, addDoc, query, where, getDocs, orderBy } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

  // --- REAL CONFIGURATION ---
  const firebaseConfig = {
    apiKey: "AIzaSyDgYTocBZ_JNTtqT_M1w8cX-WkiY9sSW3w",
    authDomain: "tasknest-test.firebaseapp.com",
    projectId: "tasknest-test",
    storageBucket: "tasknest-test.firebasestorage.app",
    messagingSenderId: "162770306478",
    appId: "1:162770306478:web:8a4150a374eaf7ec03b43f"
  };

  const app = initializeApp(firebaseConfig);
  // --- DATABASE CONNECTED TO 'tasknest' ---
  const db = getFirestore(app, "tasknest");

  // Global State
  window.userLat = "Not Shared";
  window.userLng = "Not Shared";
  window.groceryChoice = "Not specified";
  window.serviceName = "Home-Style Cooking (1-6 people)";
  window.servicePrice = "‚Çπ499 / Visit";
  window.serviceDesc = "Premium occasional cooking service.";

  const serviceCatalog = {
    "home-style-cooking": {
      title: "Home-Style Cooking (1-6 people)",
      price: "‚Çπ499 / Visit",
      desc: "Premium occasional cooking service."
    },
    "event-cooking": {
      title: "Event Cooking (7-15 people)",
      price: "Custom Quote",
      desc: "Full event cooking for small gatherings and celebrations."
    },
    "home-organization": {
      title: "Home Organization & Reset",
      price: "Custom Quote",
      desc: "Deep home organization, cleanup, and reset support."
    },
    "seasonal-concierge": {
      title: "Seasonal / Event Concierge",
      price: "Custom Quote",
      desc: "Seasonal setup, planning, and concierge assistance."
    }
  };

  const applyService = (serviceKey) => {
    const activeService = serviceCatalog[serviceKey] || serviceCatalog["home-style-cooking"];

    window.serviceName = activeService.title;
    window.servicePrice = activeService.price;
    window.serviceDesc = activeService.desc;

    const titleEl = document.getElementById('serviceTitle');
    const priceEl = document.getElementById('servicePrice');
    const descEl = document.getElementById('serviceDesc');
    const bookingTitleEl = document.getElementById('bookingTitle');

    if (titleEl) titleEl.innerText = window.serviceName;
    if (priceEl) priceEl.innerText = window.servicePrice;
    if (descEl) descEl.innerText = window.serviceDesc;
    if (bookingTitleEl) bookingTitleEl.innerText = `Book: ${window.serviceName}`;
  };

  window.applyService = applyService;

  const params = new URLSearchParams(window.location.search);
  const serviceKey = params.get('service') || "home-style-cooking";
  applyService(serviceKey);

  if (params.get('book') === '1') {
    window.openBooking?.(serviceKey);
  }

  // --- 2. BOOKING & WHATSAPP FUNCTION ---
  window.confirmAndWhatsApp = () => {
    const phone = document.getElementById('loginPhone').value;
    const name = document.getElementById('name').value;
    const date = document.getElementById('date').value;
    const time = document.getElementById('timeSlot').value;
    const address = document.getElementById('address').value;
    const ingredientSource = document.getElementById('ingredientSource').value;

    if(!phone || phone.length !== 10) {
      alert("Please enter a valid 10-digit number");
      return;
    }

    if(!name || !date || !address) {
      alert("Please fill Name, Address and Date.");
      return;
    }

    // Switch to Success Screen
    hideAll();
    document.getElementById('stepSuccess').classList.remove('hidden');
    window.scrollTo(0,0);

    // Open WhatsApp
    const waMsg = `*New Booking Request*%0A*Service:* ${window.serviceName}%0A%0AUser: ${name}%0APhone: ${phone}%0ADate: ${date} (${time})%0AAddress: ${address}%0A%0A*Ingredients:* ${ingredientSource}%0A*Location:* ${window.userLat}, ${window.userLng}`;
    window.open(`https://wa.me/919509706699?text=${waMsg}`, '_blank');

    // Save to Database
    const booking = {
      phone, name, address, date, timeSlot: time,
      latitude: window.userLat, longitude: window.userLng,
      service: window.serviceName,
      ingredientSource,
      amount: 499, 
      status: "Pending Confirmation", 
      timestamp: new Date()
    };

    addDoc(collection(db, "bookings"), booking)
      .then(() => console.log("Booking saved successfully"))
      .catch((e) => console.error("Error saving booking:", e));
  };
</script>

<script>
  // --- UI NAVIGATION LOGIC ---

  function hideAll() {
    document.getElementById('stepInfo').classList.add('hidden');
    document.getElementById('stepBooking').classList.add('hidden');
    document.getElementById('stepSuccess').classList.add('hidden');
  }

  // 1. Open Booking
  function openBooking(serviceKey) {
    if (serviceKey) window.applyService?.(serviceKey);
    hideAll();
    document.getElementById('stepBooking').classList.remove('hidden');
    generateSlots();
    window.scrollTo(0,0);
  }

  // 2. Back to Dashboard
  function backToDash() {
    hideAll();
    document.getElementById('stepInfo').classList.remove('hidden');
  }

  // 3. Location Detection
  function detectLocation() {
    const status = document.getElementById('locStatus');
    const mapFrame = document.getElementById('mapFrame');
    
    if (!navigator.geolocation) { status.innerText = "Geo not supported"; return; }
    status.innerText = "Locating...";
    
    navigator.geolocation.getCurrentPosition(
      (pos) => {
        window.userLat = pos.coords.latitude;
        window.userLng = pos.coords.longitude;
        status.innerText = `Matched: ${window.userLat.toFixed(4)}, ${window.userLng.toFixed(4)}`;
        mapFrame.src = `https://maps.google.com/maps?q=Delhi&t=&z=13&ie=UTF8&iwloc=&output=embed4{window.userLat},${window.userLng}&z=15&output=embed`;
      },
      (err) => { status.innerText = "Location access denied."; status.style.color = "red"; }
    );
  }

  // 4. Time Slots
  function generateSlots() {
    const sel = document.getElementById('timeSlot');
    sel.innerHTML = "";
    // Generate slots from 10 AM to 8 PM
    for(let i=10; i<=20; i++) {
      let time = (i>12 ? i-12 : i) + (i>=12 ? " PM" : " AM");
      let opt = document.createElement('option');
      opt.value = time; opt.innerText = time;
      sel.appendChild(opt);
    }
  }

</script>

</body>
</html>
